<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>맥도날드</title>
  <link href="../../images/맥도날드_로고.png" rel="shortcut icon" type="image/x-icon">
  <link rel="stylesheet" href="../css/header.css">
  <script src="../js/script.js"></script>
  <script src="https://kit.fontawesome.com/516da99189.js" crossorigin="anonymous"></script>
  <style>
    /* ===== 기본 ===== */
    * { padding: 0; margin: 0; box-sizing: border-box; }
    body { background-color: #fbfbfb; }
    a { text-decoration: none; color: inherit; }

    /* ===== 배너(슬라이더) ===== */
    .slider-wrap { position: relative; display: flex; flex-direction: column; }
    .slider-view { overflow: hidden; width: 100%; }
    .slider-track { display: flex; list-style: none; transition: transform 0.45s; }
    .slide-item { flex: 0 0 100%; height: 500px; }
    .slide-item img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .slider-prev, .slider-next {
      position: absolute; top: 45%; padding: 50px;
      background-size: cover; background-position: center;
      cursor: pointer; background-color: transparent; z-index: 10;
    }
    .slider-prev { left: 0;  background-image: url(../images/swiper-prev-btn.png); }
    .slider-next { right: 0; background-image: url(../images/swiper-next-btn.png); }

    /* ===== 진행 바(오버레이 고정) ===== */
    .progress-wrapper {
      position: absolute; left: 50%; bottom: 16px; transform: translateX(-50%);
      display: flex; align-items: center; gap: 10px; justify-content: center;
      background: transparent; z-index: 20;
    }
    .button {
      width: 30px; height: 30px; border-radius: 50%; background-color: #ffc107;
      display: flex; justify-content: center; align-items: center;
      cursor: pointer; user-select: none; font-size: 14px; color: #fff; border: 0;
    }
    .progress-bar { width: 300px; height: 6px; background-color: #fff; border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; background-color: #ffc107; }

    /* ===== 본문 ===== */
    .contArea { width: 100%; display: flex; justify-content: center; align-items: center; }
    .inner { width: 1200px; margin-top: 20px; }
    #happyList {
      width: 100%; list-style: none; padding: 0;
      display: flex; flex-wrap: wrap; box-sizing: border-box; justify-content: flex-start;
    }
    .happy-item { width: 360px; height: 430px; list-style: none; float: left; margin: 0 20px 40px 0; }
    .happy-item img {display: block; width: 100%; height: 300px; border-radius: 10px 10px 0 0; }
    .event-textArea {
      height: 130px;
      padding: 24px 30px; border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1); background: #fff;
    }
    p { font-size: 18px; color: #292929; font-weight: 500; line-height: 1.7; margin: 0; }

    #moreBtn {
      width: 90px; height: 90px;
      background-image: url("../images/btn_more.png");
      background-size: cover; background-position: center;
      margin: 30px 0; border: none;
      background-color: #fbfbfb;
    }
    .btnArea { width: 100%; display: flex; justify-content: center; align-items: center; }
    .McDonaldsLIVE { margin: 0 0 60px; color: #292929; font-size: 40px; font-weight: 600; line-height: 1; }

    /* 드래그 중 포인터 모양 */
    .dragging { cursor: grabbing; }
  </style>
</head>
<body>
  <div id="fixedTag"></div>
  <div class="wrapper">
    <div id="header"></div>
  <div class="slider-wrap">
    <div class="slider-prev"></div>

    <div class="slider-view">
      <ul class="slider-track">
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img2.jpg" alt="1"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img3.jpg" alt="2"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img4.jpg" alt="3"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img5.jpg" alt="4"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img6.jpg" alt="5"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img7.jpg" alt="6"></a></li>
        <li class="slide-item"><a href="#"><img src="../images/mainbanner.img8.jpg" alt="7"></a></li>
      </ul>
    </div>

    <div class="slider-next"></div>

    <!-- 진행 바: 트랙 바깥, 배너 위에 고정 -->
    <div class="progress-wrapper">
      <div class="button" id="toggleBtn">❚❚</div>
      <div class="progress-bar"><div class="progress-fill" id="fill"></div></div>
    </div>
  </div>

  <!-- 바디 콘텐츠 -->
  <div class="contArea">
    <div class="inner">
      <div class="McDonaldsLIVE">McDonald's LIVE</div>
      <ul id="happyList">
        <li class="happy-item">
          <a href="../html/new/promotion_detail.html?title=가성비 간식 맛집 해피스낵!&no=2">
            <img src="../images/promotion-img1.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>가성비 간식 맛집 해피스낵!</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="./new/happymeal_detail.html?title=가성비 간식 맛집 해피스낵!&no=0">
            <img src="../images/promotion-img2.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>한국의 맛 춘식이팩 출시!</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="../html/menu/menu1.html">
            <img src="../images/promotion-img3.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>익산 고구마 모짜렐라 버거!</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="../html/new/promotion_detail.html?title=JUST MADE FOR YOU, 당신을 위해 방금 만든 맛있는 버거&no=3">
            <img src="../images/promotion-img4.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>JUST MADE FOR YOU, 당신을 위해 방금 만든 맛있는 버거</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="./new/promotion_detail.html?title=육즙 팡팡! NEW 클래식 핫도그 출시!&no=4">
            <img src="../images/promotion-img5.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>육즙 팡팡! NEW 클래식 핫도그 출시!</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="./new/promotion_detail.html?title=맥드라이브에서 스페셜팩 구매하고 VIP 클럽이 되어보세요!&no=5">
            <img src="../images/promotion-img6.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>맥드라이브에서 스페셜팩 구매하고 VIP 클럽이 되어보세요!</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="./new/promotion_detail.html?title=겉은 바삭! 속은 쫄깃!<br>겉바속쫄 맥윙&no=6">
            <img src="../images/promotion-img7.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>겉은 바삭! 속은 쫄깃!<br>겉바속쫄 맥윙</p></div>
          </a>
        </li>
        <li class="happy-item">
          <a href="./new/promotion_detail.html?title=향긋 달콤 NEW 아이스티 출시!&no=7">
            <img src="../images/promotion-img8.jpg" alt="해피밀 이벤트" />
            <div class="event-textArea"><p>향긋 달콤 NEW 아이스티 출시!</p></div>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <div class="btnArea"><button type="button" id="moreBtn"></button></div>
  <div id="footer"></div>
  </div>

  <script>
    /* ===== 슬라이더 (무한 순환 + 드래그) ===== */
    const sliderPrev  = document.querySelector('.slider-prev');
    const sliderNext  = document.querySelector('.slider-next');
    const sliderView  = document.querySelector('.slider-view');
    const sliderTrack = document.querySelector('.slider-track');

    // 원본 슬라이드 수
    let items = Array.from(document.querySelectorAll('.slide-item'));
    const originalCount = items.length;

    // 앞/뒤 클론으로 무한 순환 구성
    const firstClone = items[0].cloneNode(true);
    const lastClone  = items[originalCount - 1].cloneNode(true);
    sliderTrack.appendChild(firstClone);
    sliderTrack.insertBefore(lastClone, sliderTrack.firstChild);

    // 다시 쿼리 (클론 포함)
    items = Array.from(document.querySelectorAll('.slide-item'));
    const totalCount = items.length; // = originalCount + 2

    // 현재 인덱스: 1(= 실제 첫 슬라이드)
    let currentSlideIndex = 1;

    // 슬라이드 폭 계산
    let slideWidth = 0;
    function setSizes() {
      slideWidth = sliderView.clientWidth;
      sliderTrack.style.transform = `translateX(${-currentSlideIndex * slideWidth}px)`;
    }
    setSizes();
    window.addEventListener('resize', setSizes);

    // 이동(애니메이션 on)
    function moveTo(index) {
      sliderTrack.style.transition = 'transform 0.45s';
      
      if (index === totalCount - 1) {        // 맨 뒤(= firstClone)
        // sliderTrack.style.transition = 'none';
        index = 1;                            // 실제 1번으로 점프
        sliderTrack.style.transform = `translateX(${-index * slideWidth}px)`;
      }
      if (index === 0) {                     // 맨 앞(= lastClone)
        // sliderTrack.style.transition = 'none';
        index = originalCount;               // 실제 마지막으로 점프
        sliderTrack.style.transform = `translateX(${-index * slideWidth}px)`;
      }
      else {
        sliderTrack.style.transform  = `translateX(${-index * slideWidth}px)`;
      }
      currentSlideIndex = index;
    }

    // 경계 처리: 클론 끝에 도달 시 자연 보정(애니메이션 off로 점프)
    sliderTrack.addEventListener('transitionend', () => {
      if (currentSlideIndex === totalCount - 1) {        // 맨 뒤(= firstClone)
        sliderTrack.style.transition = 'none';
        currentSlideIndex = 1;                            // 실제 1번으로 점프
        sliderTrack.style.transform = `translateX(${-currentSlideIndex * slideWidth}px)`;
      }
      if (currentSlideIndex === 0) {                     // 맨 앞(= lastClone)
        sliderTrack.style.transition = 'none';
        currentSlideIndex = originalCount;               // 실제 마지막으로 점프
        sliderTrack.style.transform = `translateX(${-currentSlideIndex * slideWidth}px)`;
      }
    });

    // 버튼
    sliderPrev.addEventListener('click', () => {
      moveTo(currentSlideIndex - 1);
      startProgress();
    });
    sliderNext.addEventListener('click', () => {
      moveTo(currentSlideIndex + 1);
      startProgress();
    });

    // 자동 넘김 + 진행 바
    const fill   = document.getElementById('fill');
    const button = document.getElementById('toggleBtn');
    let interval = null;
    let isRunning = true;
    let progress = 0;

    function moveToNextSlide() {
      moveTo(currentSlideIndex + 1); // 경계는 transitionend에서 자동 보정
      startProgress();
    }

    function startProgress() {
      clearInterval(interval);
      progress = 0;
      fill.style.width = '0%';
      button.textContent = '❚❚';
      isRunning = true;

      interval = setInterval(() => {
        progress += 1;
        fill.style.width = progress + '%';
        if (progress >= 100) {
          clearInterval(interval);
          moveToNextSlide();
        }
      }, 50); // 5초
    }

    button.addEventListener('click', () => {
      if (isRunning) {
        clearInterval(interval);
        progress = 0;
        fill.style.width = '0%';
        button.textContent = '▶';
        isRunning = false;
      } else {
        startProgress();
      }
    });

    // 드래그/스와이프
    let isDragging = false;
    let startX = 0;
    let deltaX = 0;
    let dragged = false;

    function onDragStart(e) {
      isDragging = true;
      dragged = false;
      startX = (e.touches ? e.touches[0].clientX : e.clientX);
      deltaX = 0;
      sliderTrack.style.transition = 'none';   // 드래그 중엔 즉시 이동
      sliderView.classList.add('dragging');
      clearInterval(interval);                 // 자동재생 일시정지
    }

    function onDragMove(e) {
      if (!isDragging) return;
      const x = (e.touches ? e.touches[0].clientX : e.clientX);
      deltaX = x - startX;
      if (Math.abs(deltaX) > 3) dragged = true; // 클릭 방지 플래그
      const base = -currentSlideIndex * slideWidth;
      sliderTrack.style.transform = `translateX(${base + deltaX}px)`;
    }

    function onDragEnd() {
      if (!isDragging) return;
      isDragging = false;
      sliderView.classList.remove('dragging');

      const threshold = slideWidth * 0.2; // 20% 넘으면 넘김
      if (deltaX > threshold) {
        moveTo(currentSlideIndex - 1);
      } else if (deltaX < -threshold) {
        moveTo(currentSlideIndex + 1);
      } else {
        // 원위치 스냅백
        sliderTrack.style.transition = 'transform 0.45s';
        sliderTrack.style.transform  = `translateX(${-currentSlideIndex * slideWidth}px)`;
      }
      startProgress(); // 드래그 종료 후 자동재생 재시작
    }

    // 이벤트 바인딩 (마우스 + 터치)
    sliderView.addEventListener('mousedown', onDragStart);
    window.addEventListener('mousemove', onDragMove);
    window.addEventListener('mouseup', onDragEnd);

    sliderView.addEventListener('touchstart', onDragStart, { passive: true });
    sliderView.addEventListener('touchmove', onDragMove, { passive: true });
    sliderView.addEventListener('touchend', onDragEnd);

    // 드래그로 링크 잘못 클릭되는 것 방지
    sliderView.addEventListener('click', (e) => {
      if (dragged) e.preventDefault();
    });

    // 시작 위치를 실제 1번으로 세팅
    sliderTrack.style.transition = 'none';
    sliderTrack.style.transform  = `translateX(${-currentSlideIndex * slideWidth}px)`;

    /* ===== 더보기 ===== */
    const productList  = document.getElementById('happyList');
    const productItems = productList.querySelectorAll('.happy-item');
    const loadMoreBtn  = document.getElementById('moreBtn');

    let visibleCount = 0;
    const itemsPerClick = 6;

    productItems.forEach(item => item.style.display = 'none');
    for (let i = 0; i < itemsPerClick && i < productItems.length; i++) {
      productItems[i].style.display = 'block';
      visibleCount++;
    }
    loadMoreBtn.addEventListener('click', () => {
      const total = productItems.length;
      for (let i = visibleCount; i < visibleCount + itemsPerClick && i < total; i++) {
        productItems[i].style.display = 'block';
      }
      visibleCount += itemsPerClick;
      if (visibleCount >= total) loadMoreBtn.style.display = 'none';
    });

    // 자동재생 시작
    startProgress();
  </script>
</body>
</html>
